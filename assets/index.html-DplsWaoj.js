import{_ as i}from"./web_agent-CVQKil91.js";import{_ as a,c as n,a as l,o as e}from"./app-RmE5kr10.js";const t={};function h(k,s){return e(),n("div",null,s[0]||(s[0]=[l(`<h2 id="_1-概述" tabindex="-1"><a class="header-anchor" href="#_1-概述"><span>1. 概述</span></a></h2><p><strong>Web Collection Agent</strong> 是 DataFlow-Agent 中的智能数据收集模块，专门用于从互联网自动收集、处理和格式化训练数据集。该系统支持两种数据类型：</p><ul><li><strong>PT（Pre-Training，预训练）</strong>：大规模无标注语料，用于模型预训练。</li><li><strong>SFT（Supervised Fine-Tuning，监督微调）</strong>：结构化的指令-回答对，用于模型微调。</li></ul><p>该工作流能够：</p><ol><li><strong>网页搜索与探索</strong>：基于多层 BFS 森林探索策略，由 LLM 驱动 URL 筛选，自动发现和定位目标数据集。</li><li><strong>多平台数据下载</strong>：支持 HuggingFace、Kaggle、Web 直接下载三种方式，LLM 智能决策下载优先顺序。</li><li><strong>双通道并行采集</strong>：WebSearch 和 WebCrawler 两条采集流程并行执行，提供更丰富的数据来源。</li><li><strong>自适应数据映射</strong>：LLM 生成 Python 映射函数，通过三重验证机制，自动将异构数据转换为标准 Alpaca 格式。</li></ol><h2 id="_2-系统架构" tabindex="-1"><a class="header-anchor" href="#_2-系统架构"><span>2. 系统架构</span></a></h2><p>该功能由 <code>dataflow_agent/workflow/wf_web_collection.py</code> 编排，形成一个包含并行分支和条件循环的有向图。整体流程分为四个阶段：任务分析、数据采集（并行）、数据下载、数据处理与映射。</p><h3 id="_2-1-任务分析阶段" tabindex="-1"><a class="header-anchor" href="#_2-1-任务分析阶段"><span>2.1 任务分析阶段</span></a></h3><ol><li><p><strong>Start Node（初始化节点）</strong></p><ol><li><strong>职责</strong>: 初始化工作流配置，创建下载目录，准备执行环境。</li><li><strong>输入</strong>: <code>state.request.target</code>（用户原始需求）。</li><li><strong>输出</strong>: 初始化后的 <code>user_query</code> 和下载目录。</li></ol></li><li><p><strong>Task Decomposer（任务分解节点）</strong></p><ol><li><strong>职责</strong>: 使用 LLM 将复杂的用户需求分解为可执行的子任务，限制最大任务数量（默认 5 个）。</li><li><strong>输入</strong>: 用户原始查询。</li><li><strong>LLM 思考</strong>: 分析需求语义，拆分为独立的数据收集子任务。</li><li><strong>输出</strong>: <code>state.task_list</code>，例如： <ul><li>子任务 1：收集 NLP 问答数据集</li><li>子任务 2：收集文本分类数据集</li><li>子任务 3：收集图像分类数据集</li></ul></li></ol></li><li><p><strong>Category Classifier（分类节点）</strong></p><ol><li><strong>职责</strong>: 判断当前任务属于 PT 还是 SFT 类型。</li><li><strong>输入</strong>: 当前子任务名称。</li><li><strong>LLM 思考</strong>: 结合任务描述判断数据类别，生成数据集背景描述。</li><li><strong>输出</strong>: <code>state.category</code>（<code>&quot;PT&quot;</code> 或 <code>&quot;SFT&quot;</code>）以及 <code>dataset_background</code>。</li><li><strong>后备机制</strong>: 当 LLM 无法判断时，使用关键词匹配。SFT 关键词包括：<code>[&quot;sft&quot;, &quot;微调&quot;, &quot;问答&quot;, &quot;qa&quot;, &quot;instruction&quot;, &quot;fine-tuning&quot;]</code>。</li></ol></li></ol><h3 id="_2-2-数据采集阶段-并行执行" tabindex="-1"><a class="header-anchor" href="#_2-2-数据采集阶段-并行执行"><span>2.2 数据采集阶段（并行执行）</span></a></h3><p>任务分析完成后，系统进入 <code>parallel_collection</code> 并行分支，同时启动 WebSearch 和 WebCrawler 两条采集流程。</p><h4 id="_2-2-1-websearch-node-网页搜索节点" tabindex="-1"><a class="header-anchor" href="#_2-2-1-websearch-node-网页搜索节点"><span>2.2.1 WebSearch Node（网页搜索节点）</span></a></h4><p>WebSearch Node 是系统的核心数据收集节点，实现了完整的网页探索和信息提取流程，包含以下核心组件：</p><ol><li><p><strong>QueryGenerator（查询生成器）</strong></p><ul><li><strong>职责</strong>: 基于用户原始需求，生成 3-5 个多样化的搜索查询。</li><li><strong>示例</strong>: 输入 <code>&quot;收集 Python 代码生成数据集&quot;</code>，输出： <ul><li><code>&quot;Python code generation dataset download&quot;</code></li><li><code>&quot;Python programming instruction dataset HuggingFace&quot;</code></li><li><code>&quot;code completion training data GitHub&quot;</code></li></ul></li></ul></li><li><p><strong>WebTools（网页工具集）</strong></p><ul><li><strong>search_web()</strong>: 调用搜索引擎（Tavily / DuckDuckGo / Jina）获取初始 URL 列表。</li><li><strong>read_with_jina_reader()</strong>: 使用 Jina Reader/MinerU-HTML 爬取网页内容，返回结构化的 Markdown 格式文本。</li></ul></li><li><p><strong>多层 BFS 森林探索</strong></p><ul><li><strong>算法</strong>: 采用广度优先搜索（BFS）策略，逐层探索网页链接。每一层中，使用 Jina Reader/MinerU-HTML 爬取页面内容，提取候选 URL，再由 URLSelector 筛选最相关的链接进入下一层。</li><li><strong>关键参数</strong>: <ul><li><code>max_depth</code>: 最大探索深度（默认 2）</li><li><code>concurrent_limit</code>: 并发请求数（默认 10）</li><li><code>topk_urls</code>: 每层筛选的 URL 数量（默认 5）</li><li><code>url_timeout</code>: 请求超时时间（默认 60 秒）</li></ul></li></ul></li><li><p><strong>URLSelector（URL 筛选器）</strong></p><ul><li><strong>职责</strong>: 使用 LLM 从候选 URL 列表中选择与研究目标最相关的 URL。</li><li><strong>筛选策略</strong>: 分析 URL 与研究目标的相关性、域名可信度，避免重复内容，过滤被阻止的域名。</li></ul></li><li><p><strong>RAGManager（RAG 管理器）</strong></p><ul><li><strong>职责</strong>: 将爬取的网页内容存储到向量数据库中，支持后续的语义检索，为 SummaryAgent 提供上下文。</li></ul></li><li><p><strong>SummaryAgent（摘要代理）</strong></p><ul><li><strong>职责</strong>: 基于 RAG 检索的内容，生成具体的下载子任务。</li><li><strong>输出</strong>: 结构化的子任务列表，例如：</li></ul><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">download</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">objective</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">下载 Spider Text2SQL 数据集</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">search_keywords</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">spider dataset</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">text2sql</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">],</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">platform_hint</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">huggingface</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">priority</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="_2-2-2-webcrawler-node-网页爬虫节点" tabindex="-1"><a class="header-anchor" href="#_2-2-2-webcrawler-node-网页爬虫节点"><span>2.2.2 WebCrawler Node（网页爬虫节点）</span></a></h4><p>WebCrawler Node 专门用于从网页中提取代码块和技术内容，与 WebSearch Node 并行执行，提供更丰富的数据来源。</p><ol><li><strong>生成搜索查询</strong>: 针对代码/技术内容生成专用搜索查询。</li><li><strong>搜索与爬取</strong>: 搜索网页获取 URL 列表，使用 Jina Reader 并发爬取页面内容。</li><li><strong>代码块提取</strong>: 调用 <code>extract_code_blocks_from_markdown</code> 从 Markdown 内容中提取代码块。</li><li><strong>结果保存</strong>: 将爬取结果保存为 <code>webcrawler_crawled.jsonl</code>。</li></ol><h3 id="_2-3-数据下载阶段" tabindex="-1"><a class="header-anchor" href="#_2-3-数据下载阶段"><span>2.3 数据下载阶段</span></a></h3><p><strong>Download Node（下载节点）</strong> 执行实际的数据集下载任务，支持三种下载方式，并使用 LLM 智能决策下载优先顺序。</p><ol><li><p><strong>DownloadMethodDecisionAgent（LLM 决策）</strong></p><ul><li><strong>职责</strong>: 根据任务目标分析最佳下载方式，输出优先顺序列表，例如 <code>[&quot;huggingface&quot;, &quot;kaggle&quot;, &quot;web&quot;]</code>。</li></ul></li><li><p><strong>依次尝试每种下载方式</strong>：</p><ul><li><strong>HuggingFace</strong>: 搜索 HuggingFace Hub，LLM 选择最佳匹配数据集，调用 API 下载。</li><li><strong>Kaggle</strong>: 搜索 Kaggle 数据集，LLM 选择最佳匹配，通过 Kaggle API 下载。</li><li><strong>Web</strong>: 使用 WebAgent 智能探索网页，直接下载文件。</li></ul></li><li><p><strong>记录下载结果</strong>: 更新 <code>state.download_results</code>，包含每个数据集的下载状态和路径。</p></li></ol><h3 id="_2-4-数据处理与映射阶段" tabindex="-1"><a class="header-anchor" href="#_2-4-数据处理与映射阶段"><span>2.4 数据处理与映射阶段</span></a></h3><h4 id="postprocess-node-后处理节点" tabindex="-1"><a class="header-anchor" href="#postprocess-node-后处理节点"><span>Postprocess Node（后处理节点）</span></a></h4><ul><li><strong>职责</strong>: 检查是否还有未完成的子任务（<code>check_more_tasks</code>），如果有则循环回到采集阶段；否则进入映射阶段。</li></ul><h4 id="mapping-node-数据映射节点" tabindex="-1"><a class="header-anchor" href="#mapping-node-数据映射节点"><span>Mapping Node（数据映射节点）</span></a></h4><p>Mapping Node 负责将收集到的中间格式数据转换为标准的 Alpaca 格式，使用 LLM 生成自适应的 Python 映射函数。</p><ol><li><strong>读取中间数据</strong>: 加载 <code>intermediate.jsonl</code> 中的原始记录。</li><li><strong>LLM 生成映射函数（三重验证）</strong>: <ol><li>生成映射函数 3 次。</li><li>在样本数据上验证一致性。</li><li>通过验证后使用。</li></ol></li><li><strong>批量处理</strong>: 对所有记录执行映射转换。</li><li><strong>质量过滤</strong>: 应用质量过滤器剔除低质量数据。</li><li><strong>保存结果</strong>: 输出为 <code>.jsonl</code> 和 <code>.json</code> 两种格式。</li></ol><p><strong>Alpaca 格式定义</strong>：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">instruction</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">任务指令或问题</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">input</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">可选的输入上下文（如系统提示、SQL Schema）</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">output</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">期望的回答或输出</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>SFT 数据映射规则</strong>：</p><ul><li><code>system</code> 角色 → <code>input</code> 字段</li><li><code>user</code> 角色 → <code>instruction</code> 字段</li><li><code>assistant</code> 角色 → <code>output</code> 字段</li></ul><p><strong>映射示例（Text2SQL）</strong>：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 输入格式</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">messages</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        {</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">role</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">system</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;"> &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">content</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">CREATE TABLE farm (Id VARCHAR)</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">},</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        {</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">role</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;"> &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">content</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">How many farms are there?</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">},</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        {</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">role</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">assistant</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;"> &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">content</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT COUNT(*) FROM farm</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 输出 Alpaca 格式</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">instruction</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">How many farms are there?</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">input</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">CREATE TABLE farm (Id VARCHAR)</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">output</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT COUNT(*) FROM farm</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-状态管理与输出" tabindex="-1"><a class="header-anchor" href="#_3-状态管理与输出"><span>3. 状态管理与输出</span></a></h2><h3 id="_3-1-webcollectionstate-核心字段" tabindex="-1"><a class="header-anchor" href="#_3-1-webcollectionstate-核心字段"><span>3.1 WebCollectionState 核心字段</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataclass</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> WebCollectionState</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">MainState</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 任务相关</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    user_query</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                    # 用户原始需求</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    task_list</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> List</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Dict</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">             # 分解后的任务列表</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    current_task_index</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">           # 当前任务索引</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 搜索相关</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    research_summary</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">             # 调研总结</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    urls_visited</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> List</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">           # 已访问 URL</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    subtasks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> List</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Dict</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">              # 下载子任务</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 下载相关</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    download_results</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Dict            </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 下载结果统计</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # WebCrawler 相关</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    webcrawler_crawled_pages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> List    </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 爬取的页面</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    webcrawler_sft_records</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> List      </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># SFT 记录</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    webcrawler_pt_records</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> List       </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># PT 记录</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 映射相关</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    mapping_results</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Dict             </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 映射结果</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    intermediate_data_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">       # 中间数据路径</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-webcollectionrequest-配置" tabindex="-1"><a class="header-anchor" href="#_3-2-webcollectionrequest-配置"><span>3.2 WebCollectionRequest 配置</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataclass</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> WebCollectionRequest</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">MainRequest</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 任务配置</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    category</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">PT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">              # PT 或 SFT</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    output_format</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">alpaca</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 搜索配置</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    search_engine</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tavily</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    max_depth</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    max_urls</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    concurrent_limit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    topk_urls</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # WebCrawler 配置</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    enable_webcrawler</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> bool</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> True</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    webcrawler_num_queries</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    webcrawler_crawl_depth</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    webcrawler_concurrent_pages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-输出文件结构" tabindex="-1"><a class="header-anchor" href="#_3-3-输出文件结构"><span>3.3 输出文件结构</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>web_collection_output/</span></span>
<span class="line"><span>├── rag_db/                          # RAG 向量数据库</span></span>
<span class="line"><span>├── hf_datasets/                     # HuggingFace 下载数据</span></span>
<span class="line"><span>│   └── dataset_name/</span></span>
<span class="line"><span>├── kaggle_datasets/                 # Kaggle 下载数据</span></span>
<span class="line"><span>├── web_downloads/                   # Web 直接下载</span></span>
<span class="line"><span>├── webcrawler_output/               # WebCrawler 爬取结果</span></span>
<span class="line"><span>│   └── webcrawler_crawled.jsonl</span></span>
<span class="line"><span>├── processed_output/                # 后处理结果</span></span>
<span class="line"><span>│   └── intermediate.jsonl</span></span>
<span class="line"><span>└── mapped_output/                   # 最终映射结果</span></span>
<span class="line"><span>    ├── final_alpaca_sft.jsonl       # Alpaca 格式（JSONL）</span></span>
<span class="line"><span>    └── final_alpaca_sft.json        # Alpaca 格式（JSON）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-使用指南" tabindex="-1"><a class="header-anchor" href="#_4-使用指南"><span>4. 使用指南</span></a></h2><p>本功能提供 <strong>图形界面 (Gradio UI)</strong> 和 <strong>命令行脚本</strong> 两种使用方式。</p><h3 id="_4-1-图形界面" tabindex="-1"><a class="header-anchor" href="#_4-1-图形界面"><span>4.1 图形界面</span></a></h3><p>前端页面代码位于 <code>gradio_app/pages/web_collection.py</code>，提供了可视化的交互体验。启动 Web 界面：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">python</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gradio_app/app.py</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>访问 <code>http://127.0.0.1:7860</code> 开始使用</p><p><img src="`+i+`" alt="web_agent"></p><ol><li><code>step1:</code> 在&quot;目标描述&quot;中详细说明要收集的数据类型</li><li><code>step2:</code> 选择数据类别（PT 或 SFT）</li><li><code>step3:</code> 配置数据集数量和大小限制</li><li><code>step4:</code> 配置 LLM API 信息（URL、Key、模型）</li><li><code>step5:</code>（可选）配置 Kaggle、Tavily 等服务的密钥</li><li><code>step6:</code> 点击 <strong>&quot;开始网页采集与转换&quot;</strong> 按钮</li><li><code>step7:</code> 实时查看执行日志</li><li><code>step8:</code> 等待完成后查看结果摘要</li><li><code>step9:</code> 在下载目录中查看采集的数据</li></ol><p><strong>高级使用</strong>：展开&quot;高级配置&quot;区域，可调整搜索引擎选择、并行处理数量、缓存策略、数据转换参数等。</p><h3 id="_4-2-脚本调用" tabindex="-1"><a class="header-anchor" href="#_4-2-脚本调用"><span>4.2 脚本调用</span></a></h3><p>对于自动化任务或批量采集，推荐直接使用命令行脚本 <code>script/run_web_collection.py</code>。</p><h4 id="_1-环境变量配置" tabindex="-1"><a class="header-anchor" href="#_1-环境变量配置"><span>1. 环境变量配置</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> DF_API_URL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">https://api.openai.com/v1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> DF_API_KEY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_api_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> TAVILY_API_KEY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_tavily_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> KAGGLE_USERNAME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> KAGGLE_KEY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> RAG_API_URL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> RAG_API_KEY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-运行脚本" tabindex="-1"><a class="header-anchor" href="#_2-运行脚本"><span>2. 运行脚本</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 基本用法</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">python</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> script/run_web_collection.py</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --target</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">收集机器学习问答数据集</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 完整参数</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">python</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> script/run_web_collection.py</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --target</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">收集代码生成数据集</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --category</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> SFT</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --max-urls</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --max-depth</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --download-dir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./my_output</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>主要参数说明</strong>：</p><ul><li><strong><code>--target</code></strong>: 数据收集目标描述（必填）</li><li><strong><code>--category</code></strong>: 数据类别，<code>PT</code> 或 <code>SFT</code>（默认 <code>SFT</code>）</li><li><strong><code>--max-urls</code></strong>: 最大 URL 数量（默认 10）</li><li><strong><code>--max-depth</code></strong>: 最大爬取深度（默认 2）</li><li><strong><code>--output-format</code></strong>: 输出格式（默认 <code>alpaca</code>）</li></ul><h4 id="_3-python-api-调用" tabindex="-1"><a class="header-anchor" href="#_3-python-api-调用"><span>3. Python API 调用</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow_agent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">workflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">wf_web_collection </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> run_web_collection</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> await</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> run_web_collection</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    target</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">收集机器学习代码示例</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    category</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SFT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_format</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">alpaca</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    download_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./my_output</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    model</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gpt-4o</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-实战-case-收集中文问答数据集" tabindex="-1"><a class="header-anchor" href="#_4-3-实战-case-收集中文问答数据集"><span>4.3 实战 Case：收集中文问答数据集</span></a></h3><p>假设我们需要为聊天机器人构建一份中文问答训练数据集，以下是完整的操作流程。</p><p><strong>场景配置：</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> DF_API_URL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">https://api.openai.com/v1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> DF_API_KEY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_api_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> TAVILY_API_KEY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_tavily_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">python</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> script/run_web_collection.py</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --target</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">收集中文问答数据集用于微调</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --category</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> SFT</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    --max-urls</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>运行：</strong> 运行脚本后，工作流会按以下步骤执行：</p><ol><li><strong>任务分解</strong>: LLM 将&quot;收集中文问答数据集用于微调&quot;拆解为多个子任务（如中文常识问答、中文阅读理解等）。</li><li><strong>分类判定</strong>: 根据&quot;微调&quot;关键词，自动判定为 SFT 类型。</li><li><strong>并行采集</strong>: WebSearch 探索 HuggingFace、GitHub 等平台上的中文 QA 数据集；WebCrawler 同步抓取技术博客中的问答内容。</li><li><strong>智能下载</strong>: LLM 决策优先从 HuggingFace 下载匹配数据集，失败后回退到 Kaggle 和 Web 直接下载。</li><li><strong>格式映射</strong>: 将下载的异构数据统一转换为 Alpaca 格式，输出到 <code>mapped_output/</code> 目录。</li></ol><p>用户可以在下载目录下找到最终的 <code>final_alpaca_sft.jsonl</code> 文件，直接用于模型微调训练。</p><h3 id="_4-4-注意事项" tabindex="-1"><a class="header-anchor" href="#_4-4-注意事项"><span>4.4 注意事项</span></a></h3><ol><li><p><strong>API 密钥</strong></p><ul><li>确保配置了必要的 API 密钥</li><li>Tavily 用于搜索，Kaggle 用于下载 Kaggle 数据集</li></ul></li><li><p><strong>网络环境</strong></p><ul><li>如果在国内，建议使用 HuggingFace 镜像（设置 <code>HF_ENDPOINT</code>）</li><li>调整并行数量以适应网络带宽</li></ul></li><li><p><strong>存储空间</strong></p><ul><li>确保有足够的磁盘空间</li><li>大型数据集可能需要数 GB 空间</li></ul></li><li><p><strong>执行时间</strong></p><ul><li>采集过程可能需要较长时间（几分钟到几小时）</li><li>可以通过限制下载任务数量来控制时间</li></ul></li><li><p><strong>数据质量</strong></p><ul><li>启用 RAG 增强可以提高数据质量</li><li>调整采样参数以平衡质量和速度</li></ul></li></ol>`,67)]))}const d=a(t,[["render",h]]),g=JSON.parse('{"path":"/zh/guide/agent/web_collection/","title":"Web 数据采集","lang":"zh-CN","frontmatter":{"title":"Web 数据采集","createTime":"2026/02/14 00:00:00","permalink":"/zh/guide/agent/web_collection/"},"readingTime":{"minutes":9.47,"words":2840},"git":{"createdTime":1771085136000,"updatedTime":1771085136000,"contributors":[{"name":"xubinrui","username":"xubinrui","email":"145786190+xubinrui@users.noreply.github.com","commits":1,"avatar":"https://avatars.githubusercontent.com/xubinrui?v=4","url":"https://github.com/xubinrui"},{"name":"asd765973346","username":"asd765973346","email":"pzp0057@sjtu.edu.cn","commits":1,"avatar":"https://avatars.githubusercontent.com/asd765973346?v=4","url":"https://github.com/asd765973346"}]},"filePathRelative":"zh/notes/guide/agent/web_collection.md","headers":[]}');export{d as comp,g as data};
