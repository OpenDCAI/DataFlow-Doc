import{_ as i,c as a,a as n,o as e}from"./app-RmE5kr10.js";const t={};function l(p,s){return e(),a("div",null,s[0]||(s[0]=[n(`<h2 id="新算子" tabindex="-1"><a class="header-anchor" href="#新算子"><span>新算子</span></a></h2><p>DataFlow算子有统一基类<code>OperatorABC</code>，位于<a href="https://github.com/OpenDCAI/DataFlow/blob/main/dataflow/core/operator.py" target="_blank" rel="noopener noreferrer">https://github.com/OpenDCAI/DataFlow/blob/main/dataflow/core/operator.py</a>，这些算子需要实现基类所需的固定方法<code>run()</code></p><p>如果想要在DataFlow中添加新算子，可以参考<a href="https://github.com/OpenDCAI/DataFlow/blob/main/dataflow/operators/core_text/generate/prompted_generator.py" target="_blank" rel="noopener noreferrer">PromptedGenerator</a>算子的实现，并需实现如下步骤：</p><ol><li>文件名用下划线命名法，算子类名用驼峰命名法</li><li>用<code>@OPERATOR_REGISTRY.register()</code>修饰算子类，使其可以被全局注册机捕捉到</li><li>向算子路径的上级<code>__init__.py</code>中(比如<a href="https://github.com/OpenDCAI/DataFlow/blob/main/dataflow/operators/core_text/__init__.py" target="_blank" rel="noopener noreferrer">https://github.com/OpenDCAI/DataFlow/blob/main/dataflow/operators/core_text/<strong>init</strong>.py</a>) 按照现有算子的Lazzyloader注册方法，添加import路径以便Lazzyloader能识别到。</li></ol><p>特别的，如果算子需要实现<code>prompt_template</code>则需要进一步满足如下条件，可以参考<a href="https://github.com/OpenDCAI/DataFlow/blob/main/dataflow/operators/reasoning/generate/reasoning_answer_generator.py" target="_blank" rel="noopener noreferrer">ReasoningAnswerGenerator</a>：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">core</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompt </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> prompt_restrict</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DIYPromptABC</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">prompt_restrict</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    MathAnswerGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    GeneralAnswerGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    DiyAnswerGeneratorPrompt</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">OPERATOR_REGISTRY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">register</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> ReasoningAnswerGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">OperatorABC</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">  &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Answer Generator is a class that generates answers for given questions.</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> LLMServingABC</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Union</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">MathAnswerGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> GeneralAnswerGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DiyAnswerGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DIYPromptABC</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> MathAnswerGeneratorPrompt</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">             ):</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">     </span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">     self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">logger </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> get_logger</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">     </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">     if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> prompt_template </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">is</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> None</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">         prompt_template </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> MathAnswerGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">     self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> prompt_template</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">     self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">llm_serving </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> llm_serving</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>算子需要被<code>@prompt_restrict</code>装饰器修饰，并且需要有<code>prompt_template</code>形参，二者都需要写好当前算子支持的所有的提示词模板类。</p><p>都实现好后，可以自行测试比如<code>from dataflow.operators.core_text import PromptedGenerator</code>来测试能否正常import成功。</p><p>也可以通过<a href="https://github.com/OpenDCAI/DataFlow/tree/main/test/xlsx_overview_of_dataflow" target="_blank" rel="noopener noreferrer">https://github.com/OpenDCAI/DataFlow/tree/main/test/xlsx_overview_of_dataflow</a>这两个全局注册脚本来检查当前DataFlow注册机内所有的算子信息，正确出现了新算子即说明新算子添加成功。</p>`,9)]))}const h=i(t,[["render",l]]),k=JSON.parse('{"path":"/zh/dev_guide/new_algo/","title":"新算子","lang":"zh-CN","frontmatter":{"title":"新算子","createTime":"2025/06/12 12:00:00","permalink":"/zh/dev_guide/new_algo/"},"readingTime":{"minutes":1.21,"words":364},"git":{"createdTime":1749717987000,"updatedTime":1766479867000,"contributors":[{"name":"MOLYHECI","username":"MOLYHECI","email":"molyheci@outlook.com","commits":2,"avatar":"https://avatars.githubusercontent.com/MOLYHECI?v=4","url":"https://github.com/MOLYHECI"},{"name":"Sunnyhaze","username":"Sunnyhaze","email":"mxch1122@126.com","commits":3,"avatar":"https://avatars.githubusercontent.com/Sunnyhaze?v=4","url":"https://github.com/Sunnyhaze"},{"name":"HeRunming","username":"HeRunming","email":"2100010636@stu.pku.edu.cn","commits":1,"avatar":"https://avatars.githubusercontent.com/HeRunming?v=4","url":"https://github.com/HeRunming"}]},"filePathRelative":"zh/notes/backup/new_algo.md","headers":[]}');export{h as comp,k as data};
