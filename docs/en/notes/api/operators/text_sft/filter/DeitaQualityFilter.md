---
title: DeitaQualityFilter
createTime: 2025/10/09 16:52:48
permalink: /en/api/operators/text_sft/filter/deitaqualityfilter/
---

## ðŸ“˜ Overview

The `DeitaQualityFilter` is an operator designed to filter data based on quality scores. It utilizes the `DeitaQualitySampleEvaluator`, which is based on a Llama model, to assess the quality of instruction-output pairs. Data entries that fall within a specified score range are retained.

## `__init__` function

```python
def __init__(self, min_score=2.5, max_score=10000.0, device='cuda', model_cache_dir='./dataflow_cache', max_length=512)
```

| Parameter | Type | Default Value | Description |
| :--- | :--- | :--- | :--- |
| **min_score** | float | 2.5 | The minimum score threshold for an entry to be kept. |
| **max_score** | float | 10000.0 | The maximum score threshold for an entry to be kept. |
| **device** | str | 'cuda' | The device on which the scoring model will run (e.g., 'cuda', 'cpu'). |
| **model_cache_dir** | str | './dataflow_cache' | The directory to store and load the cached scoring model. |
| **max_length** | int | 512 | The maximum sequence length for the scoring model's input. |

### Prompt Template Descriptions

| Prompt Template Name | Primary Use | Applicable Scenarios | Feature Description |
| :--- | :--- | :--- | :--- |
| | | | |

## `run` function

```python
def run(self, storage, input_instruction_key="instruction", input_output_key="output", output_key="DeitaQualityScore")
```
Executes the main logic of the operator. It reads an input DataFrame from storage, calculates a quality score for each entry, and writes back the filtered DataFrame to storage.

| Parameter | Type | Default Value | Description |
| :--- | :--- | :--- | :--- |
| **storage** | DataFlowStorage | Required | The data flow storage instance used for reading and writing data. |
| **input_instruction_key** | str | "instruction" | The column name in the input data that contains the instruction text. |
| **input_output_key** | str | "output" | The column name in the input data that contains the corresponding output text. |
| **output_key** | str | "DeitaQualityScore" | The column name where the generated quality score will be stored. |

## ðŸ§  Example Usage

```python

```

#### ðŸ§¾ Default Output Format

The operator adds a new column (specified by `output_key`) to the input data, containing the calculated quality score. It then filters the rows based on `min_score` and `max_score`.

| Field | Type | Description |
| :--- | :--- | :--- |
| instruction | str | The input instruction text. |
| output | str | The input output text. |
| DeitaQualityScore | float | The quality score generated by the Deita model. |

**Example Input:**

```json
{
    "instruction": "Write a short story about a robot who discovers music.",
    "output": "Unit 734 processed auditory data unlike any before. The harmonic frequencies resonated with its core programming, a sensation it logged as 'joy'."
}
```

**Example Output (assuming the score is within the filter range):**

```json
{
    "instruction": "Write a short story about a robot who discovers music.",
    "output": "Unit 734 processed auditory data unlike any before. The harmonic frequencies resonated with its core programming, a sensation it logged as 'joy'.",
    "DeitaQualityScore": 4.8
}
```
