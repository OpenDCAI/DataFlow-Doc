---
title: RMFilter
createTime: 2025/10/09 16:52:48
permalink: /en/api/operators/text_sft/filter/rmfilter/
---

## ðŸ“˜ Overview

The `RMFilter` is an operator designed to filter data based on scores generated by a Reward Model (RM). It uses a pre-trained reward model, `RMSampleEvaluator`, to evaluate the quality of text samples (e.g., instruction-response pairs) and retains only those samples whose scores fall within a specified range `[min_score, max_score]`. This is useful for curating high-quality datasets by filtering out undesirable or low-quality responses.

## `__init__`

```python
def __init__(self, min_score: float = 0.2, max_score: float = 0.8, device='cuda', model_cache_dir='./dataflow_cache'):
```

| Parameter | Type | Default Value | Description |
| :--- | :--- | :--- | :--- |
| **min_score** | float | 0.2 | The minimum reward score threshold for retaining a sample. |
| **max_score** | float | 0.8 | The maximum reward score threshold for retaining a sample. |
| **device** | str | 'cuda' | The device on which to run the reward model (e.g., 'cuda', 'cpu'). |
| **model_cache_dir** | str | './dataflow_cache' | The directory to cache the downloaded reward model files. |

## Prompt Template Descriptions

## `run`

```python
def run(self, storage: DataFlowStorage, input_instruction_key: str = 'instruction', input_output_key: str = 'output', output_key: str = 'RMScore'):
```

| Parameter | Type | Default Value | Description |
| :--- | :--- | :--- | :--- |
| **storage** | DataFlowStorage | Required | The data flow storage instance used for reading and writing data. |
| **input_instruction_key** | str | "instruction" | The column name in the input data that contains the instruction text. |
| **input_output_key** | str | "output" | The column name in the input data that contains the response text to be scored. |
| **output_key**| str | "RMScore" | The column name where the generated reward score will be stored. |

## ðŸ§  Example Usage

#### ðŸ§¾ Default Output Format
The operator adds a new column (defaulting to `RMScore`) to the existing data. Only rows where the score is between `min_score` and `max_score` are kept.

| Field | Type | Description |
| :--- | :--- | :--- |
| instruction | str | The input instruction text. |
| output | str | The input response text. |
| RMScore | float | The score assigned by the reward model. |

**Example Input:**
```json
{
    "instruction": "Explain the theory of relativity in simple terms.",
    "output": "The theory of relativity, developed by Albert Einstein, is a cornerstone of modern physics. It has two main components: special relativity and general relativity. Special relativity deals with the relationship between space and time for objects moving at constant speeds. One of its most famous consequences is the equation E=mc^2, which shows that mass and energy are interchangeable. General relativity is a theory of gravitation, proposing that massive objects cause a distortion in space-time, which is felt as gravity."
}
```

**Example Output (assuming the generated score is 0.75, which is within the default [0.2, 0.8] range):**
```json
{
    "instruction": "Explain the theory of relativity in simple terms.",
    "output": "The theory of relativity, developed by Albert Einstein, is a cornerstone of modern physics. It has two main components: special relativity and general relativity. Special relativity deals with the relationship between space and time for objects moving at constant speeds. One of its most famous consequences is the equation E=mc^2, which shows that mass and energy are interchangeable. General relativity is a theory of gravitation, proposing that massive objects cause a distortion in space-time, which is felt as gravity.",
    "RMScore": 0.75
}
```
