---
title: LLMOutputParser
createTime: 2026/01/20 20:15:00
permalink: /zh/api/operators/pdf2vqa/generate/llmoutputparser/
---

## ğŸ“˜ æ¦‚è¿°

`LLMOutputParser` æ˜¯ä¸€ä¸ªç»“æ„åŒ–æ•°æ®è§£æç®—å­ï¼Œä¸“é—¨ç”¨äºè§£æå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ç”Ÿæˆçš„å¸¦æœ‰ç‰¹å®š XML æ ‡ç­¾çš„å“åº”æ–‡æœ¬ã€‚

è¯¥ç®—å­çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ï¼š
1.  **æ ‡ç­¾è§£æ**ï¼šè¯†åˆ«å¹¶æå– `<chapter>`ã€`<qa_pair>`ã€`<question>`ã€`<answer>`ã€`<solution>` å’Œ `<label>` ç­‰æ ‡ç­¾ä¸­çš„å†…å®¹ã€‚
2.  **ID è¿˜åŸ**ï¼šå°† LLM è¿”å›çš„æ•°å­— ID æ˜ å°„å›åŸå§‹çš„æ–‡æœ¬å†…å®¹æˆ–å›¾ç‰‡æ ‡ç­¾ï¼ˆåŸºäº `MinerU2LLMInputOperator` ç”Ÿæˆçš„è½¬æ¢å¸ƒå±€æ–‡ä»¶ï¼‰ã€‚
3.  **èµ„æºåŒæ­¥**ï¼šè‡ªåŠ¨å°†å…³è”çš„å›¾ç‰‡ä»ä¸­é—´ç›®å½•å¤åˆ¶åˆ°æœ€ç»ˆè¾“å‡ºç›®å½•ï¼Œå¹¶ä¿®æ­£å›¾ç‰‡å¼•ç”¨è·¯å¾„ã€‚

## `__init__` å‡½æ•°

```python
def __init__(self,  
             output_dir: str, 
             intermediate_dir: str = "intermediate"
             )

```

### init å‚æ•°è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| --- | --- | --- | --- |
| **output_dir** | str | å¿…éœ€ | ç»“æ„åŒ–æ•°æ®åŠå›¾ç‰‡çš„æœ€ç»ˆè¾“å‡ºæ ¹ç›®å½•ã€‚ |
| **intermediate_dir** | str | "intermediate" | ä¸­é—´ä»¶ç›®å½•ï¼Œç”¨äºå¯»æ‰¾ MinerU å¤„ç†åçš„åŸå§‹å›¾ç‰‡èµ„æºã€‚ |

## XML æ ‡ç­¾åè®®

ç®—å­é¢„è®¾ LLM ä¼šæŒ‰ç…§ä»¥ä¸‹ç»“æ„è¿”å›æ•°æ®ï¼š

* `<chapter>`: ç« èŠ‚åŒºå—ï¼Œå†…å«æ ‡é¢˜å’Œå¤šä¸ª QA å¯¹ã€‚
* `<title>`: ç« èŠ‚æ ‡é¢˜å¯¹åº”çš„ **ID**ã€‚
* `<qa_pair>`: å•ä¸ªé—®ç­”å¯¹åŒºå—ã€‚
* `<question>` / `<solution>`: å¯¹åº”å†…å®¹çš„ **ID** åˆ—è¡¨ï¼ˆå¦‚ `1, 2, 5`ï¼‰ã€‚
* `<answer>`: ä» solution ä¸­æå–å‡ºçš„ç­”æ¡ˆï¼Œ**æ˜¯å…·ä½“å†…å®¹ï¼Œä¸æ˜¯ID**
* `<label>`: é¢˜ç›®ç±»å‹æˆ–æ ‡ç­¾ä¿¡æ¯ï¼Œ**æ˜¯çœŸå®åºå·ï¼Œä¸æ˜¯ID**ã€‚

## `run` å‡½æ•°

```python
def run(self, 
        storage: DataFlowStorage, 
        input_response_path_key: str, 
        input_converted_layout_path_key: str, 
        input_name_key: str, 
        output_qalist_path_key: str
        )

```

æ‰§è¡Œè§£æé€»è¾‘ï¼šè¯»å– LLM å“åº”ï¼Œå¯¹ç…§å¸ƒå±€ JSON æ–‡ä»¶è¿˜åŸå†…å®¹ï¼Œä¿å­˜ä¸º JSONL æ ¼å¼ã€‚

#### å‚æ•°è¯´æ˜

| åç§° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| --- | --- | --- | --- |
| **storage** | DataFlowStorage | å¿…éœ€ | æ•°æ®æµå­˜å‚¨å®ä¾‹ã€‚ |
| **input_response_path_key** | str | å¿…éœ€ | LLM åŸå§‹å“åº”æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„åˆ—åã€‚ |
| **input_converted_layout_path_key** | str | å¿…éœ€ | è½¬æ¢åå¸ƒå±€æ–‡ä»¶ï¼ˆ`_converted.json`ï¼‰çš„è·¯å¾„åˆ—åã€‚ |
| **input_name_key** | str | å¿…éœ€ | ç”¨äºåŒºåˆ†ä»»åŠ¡çš„åç§°åˆ—ï¼Œå†³å®šäº†è¾“å‡ºæ–‡ä»¶å¤¹çš„å‘½åã€‚ |
| **output_qalist_path_key** | str | å¿…éœ€ | è¾“å‡º JSONL æ–‡ä»¶çš„è·¯å¾„åˆ—åã€‚ |

## ğŸ§  ç¤ºä¾‹é€»è¾‘

### 1. ID è¿˜åŸè¿‡ç¨‹

å‡è®¾ LLM è¿”å›ï¼š`<question>1, 3</question>`
ç®—å­ä¼šæŸ¥æ‰¾å¸ƒå±€ JSON ä¸­ `id` ä¸º 1 å’Œ 3 çš„é¡¹ï¼š

* å¦‚æœ `id: 1` æ˜¯æ–‡æœ¬ "ä»€ä¹ˆæ˜¯ AIï¼Ÿ"ï¼Œ`id: 3` æ˜¯å›¾ç‰‡ `path/to/img.png`ã€‚
* è¿˜åŸåçš„å†…å®¹ä¸ºï¼š`ä»€ä¹ˆæ˜¯ AIï¼Ÿ\n![image](vqa_images/img.png)`ã€‚

### 2. è¾“å‡ºæ–‡ä»¶ç»“æ„

æ‰§è¡Œåï¼Œ`cache_path` ä¸‹çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```text
cache_path/
â””â”€â”€ {name}/
    â”œâ”€â”€ extracted_questions.jsonl  # ç»“æ„åŒ–æ•°æ®
    â””â”€â”€ vqa_images/           # è‡ªåŠ¨åŒæ­¥è¿‡æ¥çš„å›¾ç‰‡
        â”œâ”€â”€ img1.png
        â””â”€â”€ ...

```

### 3. JSONL è¾“å‡ºç¤ºä¾‹

```json
{
  "question": "è¯·çœ‹ä¸‹å›¾å¹¶åˆ†æï¼š\n![image](vqa_images/img1.png)",
  "answer": "è¿™æ˜¯è§£æåçš„ç­”æ¡ˆæ–‡æœ¬",
  "solution": "è¯¦ç»†çš„è§£é¢˜æ­¥éª¤...",
  "label": "1",
  "chapter_title": "ç¬¬ä¸€ç«  åŸºç¡€æ¦‚è®º"
}

```