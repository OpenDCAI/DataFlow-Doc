---
title: QA_Merger
createTime: 2026/01/20 20:25:00
permalink: /zh/api/operators/pdf2vqa/generate/qamerger/
---

## ğŸ“˜ æ¦‚è¿°

`QA_Merger` æ˜¯ä¸€ä¸ªç”¨äºåˆå¹¶é¢˜ç›®ä¸ç­”æ¡ˆçš„åå¤„ç†ç®—å­ã€‚å®ƒé€šå¸¸æ¥æ”¶æ¥è‡ª `LLMOutputParser` çš„ä¸¤ä¸ªç‹¬ç«‹è¾“å‡ºï¼ˆä¸€ä¸ªæ˜¯æå–çš„é¢˜ç›®åˆ—è¡¨ï¼Œå¦ä¸€ä¸ªæ˜¯æå–çš„ç­”æ¡ˆåˆ—è¡¨ï¼‰ï¼Œå¹¶å°†å®ƒä»¬æŒ‰ç…§ç« èŠ‚æ ‡é¢˜å’Œé¢˜ç›®åºå·åŒ¹é…åˆå¹¶ä¸ºå®Œæ•´çš„é—®ç­”å¯¹ï¼ˆQA Pairsï¼‰ã€‚

### ä¸»è¦åŠŸèƒ½ï¼š
* **åŒå‘åˆå¹¶**ï¼šæ ¹æ®ç« èŠ‚æ ‡é¢˜æˆ–åºå·é€»è¾‘ï¼Œå°†é¢˜ç›®ã€ç­”æ¡ˆã€è§£é¢˜æ­¥éª¤å’Œæ ‡ç­¾ç»„åˆåœ¨ä¸€èµ·ã€‚
* **æ ¼å¼è½¬æ¢**ï¼šå°†åˆå¹¶åçš„ `.jsonl` æ•°æ®è‡ªåŠ¨è½¬æ¢ä¸ºæ˜“äºé˜…è¯»çš„ `.md`ï¼ˆMarkdownï¼‰æ ¼å¼ã€‚
* **æ•°æ®å¹³é“ºï¼ˆExplodeï¼‰**ï¼šå°†åŸæœ¬æŒ‰æ–‡ä»¶ç»„ç»‡çš„ DataFrame è¡Œï¼ŒæŒ‰ QA å¯¹è¿›è¡Œæ‹†åˆ†ã€‚åŸæœ¬ä¸€ä¸ªæ–‡ä»¶å ä¸€è¡Œï¼Œæ‰§è¡Œåæ¯ä¸ª QA å¯¹å°†å æ®ä¸€è¡Œï¼Œæ–¹ä¾¿åç»­ç»†ç²’åº¦çš„å¤„ç†ã€‚

## `__init__` å‡½æ•°

```python
def __init__(self, output_dir: str, strict_title_match: bool = False)

```

### init å‚æ•°è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| --- | --- | --- | --- |
| **output_dir** | str | å¿…éœ€ | åˆå¹¶åæ–‡ä»¶çš„è¾“å‡ºæ ¹ç›®å½•ã€‚ |
| **strict_title_match** | bool | False | æ˜¯å¦å¼€å¯ä¸¥æ ¼æ ‡é¢˜åŒ¹é…ã€‚è‹¥ä¸º Trueï¼Œåˆ™åˆå¹¶æ—¶ä¼šä¸¥æ ¼æ ¡éªŒç« èŠ‚æ ‡é¢˜ã€‚è‹¥ä¸ºFalseï¼Œæ ¡éªŒå‰ä¼šå°è¯•ä»æ ‡é¢˜ä¸­æå–**ä¸­æ–‡/è‹±æ–‡åºå·** |

## `run` å‡½æ•°

```python
def run(self, 
        storage: DataFlowStorage, 
        input_question_qalist_path_key: str, 
        input_answer_qalist_path_key: str, 
        input_name_key: str, 
        output_merged_qalist_path_key: str, 
        output_merged_md_path_key: str, 
        output_qa_item_key: str = "qa_item"
        )

```

æ‰§è¡Œåˆå¹¶é€»è¾‘ï¼šè¯»å–é¢˜ç›®å’Œç­”æ¡ˆçš„ JSONL æ–‡ä»¶ï¼Œè°ƒç”¨å†…ç½®å·¥å…·å‡½æ•°åˆå¹¶ï¼Œå¹¶æ›´æ–°å­˜å‚¨ã€‚

#### å‚æ•°è¯´æ˜

| åç§° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| --- | --- | --- | --- |
| **storage** | DataFlowStorage | å¿…éœ€ | æ•°æ®æµå­˜å‚¨å®ä¾‹ã€‚ |
| **input_question_qalist_path_key** | str | å¿…éœ€ | é¢˜ç›® JSONL æ–‡ä»¶çš„è·¯å¾„åˆ—åã€‚ |
| **input_answer_qalist_path_key** | str | å¿…éœ€ | ç­”æ¡ˆ JSONL æ–‡ä»¶çš„è·¯å¾„åˆ—åã€‚ |
| **input_name_key** | str | å¿…éœ€ | ä»»åŠ¡åç§°åˆ—åï¼Œç”¨äºåˆ›å»ºè¾“å‡ºå­ç›®å½•ã€‚ |
| **output_merged_qalist_path_key** | str | å¿…éœ€ | åˆå¹¶å JSONL æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„åˆ—åã€‚ |
| **output_merged_md_path_key** | str | å¿…éœ€ | åˆå¹¶å Markdown æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„åˆ—åã€‚ |
| **output_qa_item_key** | str | "qa_item" | **å…³é”®å‚æ•°**ï¼šå±•å¼€åçš„ QA å†…å®¹å­˜å‚¨åˆ—åã€‚æ¯è¡Œå°†åŒ…å«ä¸€ä¸ªå…·ä½“çš„é—®ç­”å¯¹å­—å…¸ã€‚ |

## ğŸ§  æ ¸å¿ƒé€»è¾‘ï¼šæ•°æ®å±•å¼€ (Explode)

ä¸å…¶ä»–ç®—å­ä¸åŒï¼Œ`QA_Merger` ä¼šæ”¹å˜ DataFrame çš„è¡Œæ•°ã€‚

1. **åˆå¹¶æ–‡ä»¶**ï¼šå®ƒé¦–å…ˆåœ¨ç£ç›˜ä¸Šç”Ÿæˆä¸€ä¸ª `merged_qa_pairs.jsonl`ï¼Œè¯¥æ–‡ä»¶åŒ…å«è¯¥æ–‡æ¡£çš„æ‰€æœ‰é—®ç­”å¯¹ã€‚
2. **å­˜å‚¨å¯¹è±¡**ï¼šå°†è¿™äº›é—®ç­”å¯¹ä»¥ `list` å½¢å¼è¯»å…¥ `output_qa_item_key` åˆ—ã€‚
3. **æ‰§è¡Œ Explode**ï¼šè°ƒç”¨ `dataframe.explode()`ã€‚
* **å¤„ç†å‰**ï¼š2 è¡Œè®°å½•ï¼ˆå¯¹åº” 2 ä¸ª PDF æ–‡ä»¶ï¼Œå„åŒ…å« 10ï¼Œ5 ä¸ª QA å¯¹ï¼‰ã€‚
* **å¤„ç†å**ï¼š15 è¡Œè®°å½•ï¼ˆæ¯è¡Œå¯¹åº” 1 ä¸ªå…·ä½“çš„ QA å¯¹ï¼Œå…¶ä»–åˆ—æ•°æ®å¦‚ `input_name` ä¼šè‡ªåŠ¨å¤åˆ¶å¡«å……ï¼‰ã€‚



## ğŸ§  ç¤ºä¾‹ç»“æœ

#### ğŸ§¾ Markdown è¾“å‡ºç¤ºä¾‹ (`merged_qa_pairs.md`)

```markdown
# Chapter: ç¬¬ä¸€ç«  å¯¼è®º

**Question 1**: ä»€ä¹ˆæ˜¯æ•°æ®æµç³»ç»Ÿï¼Ÿ
**Answer**: ä¸€ç§...
**Solution**: æ•°æ®æµç³»ç»Ÿæ˜¯ä¸€ç§...
**Label**: 1

---

**Question 2**: [image](images/fig2.png) è¯·æè¿°æ­¤å›¾ã€‚
...

```

#### ğŸ§¾ DataFrame å±•å¼€ç¤ºä¾‹

| index | name | qa_item (åˆ—) |
| --- | --- | --- |
| 0 | task_01 | {'question': 'Q1...', 'answer': 'A1...', ...} |
| 1 | task_01 | {'question': 'Q2...', 'answer': 'A2...', ...} |
| 2 | task_02 | {'question': 'Q1...', 'answer': 'A1...', ...} |
